/*! game-of-life 10-05-2014 */
GolBase=function(a){var b={},c={},d={max_processes:4,computation_method:"asynchronous"},a=a||{};return c.spawnAsyncProcess=function(a,b,c){c(a,b)},c.spawnWebWorker=function(){},c.spawnParallelProcess=function(b,d,e,f){"asynchronous"===a.computation_method?c.spawnAsyncProcess(b,d,e,f):"threaded"===a.computation_method?c.spawnWebWorker(b,e,f):console.error("bad call to spawnParrallelProcess")},b.parallelProcessArray=function(b,d,e){var f="asynchronous"==a.computation_method?a.max_processes:1,g=Math.round(b.length/f),h=0,i=null,j=[],k=[],l=function(a,b){if(j.push({data:a,order:b}),j.length===g){for(j.sort(function(a,b){return b.order-a.order}),resultsIt=0;resultsIt<j.length;resultsIt++)k.join(j[resultsIt].data);null!=e&&e(k)}};for(h=0;h<b.length;h+=g)i=b.splice(h,h+g),c.spawnParallelProcess(i,h,d,l)},b.setConfig=function(a,b){var c;b="undefined"!=typeof b?b:a;for(c in a)a.hasOwnProperty(c)&&!b.hasOwnProperty(c)&&(b[c]=a[c]);return b},b.extractGrid=function(a,b,c){var d,e,f,g=[],h=c.length;for(e=b-1;b+1>=e;e++)if(0>b-1||b+1>=h)g.push([0,0,0]);else{for(d=[],f=a-1;a+1>=f;f++)d.push(0>a-1?0:c[e][f]);g.push(d),d=null}return g},b.setConfig(d,a),b},GolController=function(config){"use strict";var r={},a={},defaultConfig={canvas:"canvas",display:"",width:300,height:300,master_timer:300,colours:{foreground:"#C2FF85",background:"#C2C2C2"},seed_density:25},engine,display,self=this;return a.run=function(){engine.run(display.drawDisplay)},a.pause=function(){engine.suspend()},a.rebuild=function(){engine.rebuild()},r.init=function(){config=self.setConfig(defaultConfig,config),engine=new GolEngine(config),display=eval("new GolDisplay"+config.display+"("+JSON.stringify(config)+");")},r.init(),a},GolController.prototype=new GolBase,GolDisplay=function(a){"use strict";var b={},c={},d=this,e={width:300,height:300,selector:"canvas",colours:{background:"#FFFFFF",foreground:"#C2FF85"}},f=null,g=null;return c.setupDisplay=function(){f=document.getElementById(a.selector),f.style.width=a.width,f.style.height=a.height,g=canvas.getContext("2d")},b.drawDisplay=function(b){var c=function(b,c){var d,e,f;for(d=0;d<b.length;d++)for(e=0;e<b[d].length;e++)f=b[d][e],g.fillStyle=f>0?a.colours.foreground:a.colours.background,g.fillRect(e,d+c,1,1);return b};c(b,0)},c.init=function(){a=d.setConfig(e,a),c.setupDisplay()},c.init(),b},GolDisplay.prototype=new GolBase,GolDisplayHTML=function(a){"use strict";var b={},c={},d=this,e={width:300,height:300,selector:"canvas",colours:{background:"#FFFFFF",foreground:"#C2FF85"}},f=null;return c.setupDisplay=function(){f=document.getElementById(a.selector),f.style.background=a.colours.background,f.style.color=a.colours.foreground},b.drawDisplay=function(a){var b=function(a){return a=a.replace(/1/g,"<span class='alive'>1</span>")};f.innerHTML=b(c.dumpDataString(a," "))},c.dumpDataString=function(a,b){var c,d,e,f=a.length,g="";for(d=0;f>d;d++){for(c=a[d].length,e=0;c>e;e++)g+=a[d][e],e!==c&&(g+=b);g+="\n"}return g},c.init=function(){a=d.setConfig(e,a),c.setupDisplay()},c.init(),b},GolDisplayHTML.prototype=new GolBase,GolEngine=function(a){"use strict";var b,c,d={},e={},f=this,g=!1,h={width:300,height:300,master_timer:300,seed_density:50},i=0,j=0,k=0;return d.dumpDataString=function(a){var c,d,e,f=b.length,g="";for(d=0;f>d;d++){for(c=b[d].length,e=0;c>e;e++)g+=b[d][e],e!==c&&(g+=a);g+="\n"}return g},d.isActive=function(){return g===!0?!0:!1},d.run=function(a){e.simLoopStart(a)},d.suspend=function(){e.simLoopSuspend()},d.rebuild=function(){e.setupSimulation()},e.setObjectActive=function(){g=!0},e.setObjectInactive=function(){g=!1},e.simLoopStart=function(d){e.setObjectActive(),c=setInterval(function(){e.simStepForward(),d(b)},a.master_timer)},e.simLoopSuspend=function(){clearInterval(c),e.setObjectInactive()},e.simStepForward=function(){var a,c,d,f,g=b.length,h=[];for(j=0,i=0,k=0,c=0;g>c;c++){for(f=[],a=b[c].length,d=0;a>d;d++)f.push(e.checkRulez(d,c));h.push(f)}return b=h,h=null,b},e.checkRulez=function(a,c){var d=f.extractGrid(a,c,b),e=d[1][1],g=d.sum()-e,h=0;if(e>0)switch(g){case 2:h=1,i+=1;break;case 3:h=1,i+=1;break;default:h=0,j+=1}else 3===g&&(h=1,k+=1);return h},e.setupSimulation=function(){var c,d,e,f=a.height,g=a.width,h=[];for(d=0;f>d;d++){if(c=[],d>f/2-a.seed_density&&d<f/2+a.seed_density)for(e=0;g>e;e++)c.push(e>g/2-a.seed_density&&e<g/2+a.seed_density?Math.round(Math.random()):0);else for(e=0;g>e;e++)c.push(0);h.push(c)}return b=h,h},e.init=function(){a=f.setConfig(h,a),e.setupSimulation()},e.init(),d},GolEngine.prototype=new GolBase,Array.prototype.sum=function(a){"use strict";var b="undefined"==typeof a?0:a,c=0;if(this[b]instanceof Array)for(b;b<this.length;b++)c+=this[b].sum();else for(b=0;b<this.length;b++)c+=this[b];return c};